<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vastu Compass (32 Zones)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1f2937 0%, #0f172a 100%);
            color: #e2e8f0;
            touch-action: none;
            /* Prevent touch actions like zooming or panning */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            overflow: hidden;
        }

        .compass-container {
            position: relative;
            width: 90vmin;
            height: 90vmin;
            max-width: 32rem;
            max-height: 32rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), inset 0 0 10px rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            overflow: hidden;
            background: radial-gradient(circle, #2d3748 0%, #1a202c 100%);
            border: 4px solid #4a5568;
            margin-bottom: 2rem;
        }
        
        #compass-face-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: transform 0.1s ease-out;
        }

        #compassCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .compass-needle-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2; /* Ensure the needle is always on top */
        }
        
        #needle {
            position: absolute;
            width: 1.5rem;
            height: 90%;
            transform-origin: center center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .needle-red {
            width: 1.5rem;
            height: 50%;
            background-color: #ef4444;
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
            transform: translateY(-0.1rem);
        }

        .needle-grey {
            width: 1.5rem;
            height: 50%;
            background-color: #6b7280;
            clip-path: polygon(50% 100%, 100% 0%, 0% 0%);
            transform: translateY(0.1rem);
        }

        .needle-pivot {
            width: 2.2rem;
            height: 2.2rem;
            background: radial-gradient(circle, #e2e8f0 0%, #3b82f6 100%);
            border-radius: 50%;
            position: absolute;
            z-index: 10;
        }

        .info-box {
            background-color: #2d3748;
            border: 1px solid #4a5568;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 32rem;
            margin-top: 2rem;
        }

        .info-box h2 {
            color: #3b82f6;
        }
    </style>
</head>

<body class="bg-gray-900 flex flex-col items-center justify-center min-h-screen text-gray-200 p-4">

    <!-- Compass Container -->
    <div class="flex flex-col items-center">
        <h1 class="text-3xl font-bold mb-2">Vastu Compass</h1>
        <p class="text-gray-400 mb-6 text-center">Hold your device flat and level to find your Vastu direction.</p>

        <div class="compass-container">
            <!-- This wrapper rotates to show the correct direction -->
            <div id="compass-face-wrapper">
                <canvas id="compassCanvas" class="w-full h-full"></canvas>
            </div>
            
            <!-- Compass Needle - this stays fixed at the top -->
            <div class="compass-needle-container">
                <div id="needle">
                    <div class="needle-red"></div>
                    <div class="needle-grey"></div>
                </div>
                <div class="needle-pivot"></div>
            </div>
        </div>

        <!-- Direction and Vastu Info Display -->
        <div class="info-box">
            <div class="text-center mb-4">
                <h2 class="text-4xl font-extrabold" id="angle-display">--Â°</h2>
                <p class="text-xl text-gray-400" id="direction-name">Calibrating...</p>
            </div>
            <div id="vastu-tips" class="text-sm">
                <h3 class="font-semibold text-lg text-blue-300 mb-2">Vastu Tips for this Direction</h3>
                <div id="vastu-content" class="text-gray-300">
                    <p>Hold your device flat and level to begin. The tips will appear here.</p>
                </div>
            </div>
        </div>

        <!-- Message/Status Display -->
        <div id="message-box-container" class="mt-6">
            <div id="message-box" class="p-4 bg-gray-800 border border-gray-700 text-gray-400 rounded-lg text-sm transition-opacity duration-300 max-w-sm text-center">
                <p>Please grant permission to use the device sensor.</p>
            </div>
        </div>

        <!-- Permission Button (iOS 13+) -->
        <button id="permission-button" class="mt-4 px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition-colors duration-300">
            Allow Access
        </button>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const permissionButton = document.getElementById('permission-button');
            const directionName = document.getElementById('direction-name');
            const angleDisplay = document.getElementById('angle-display');
            const vastuTips = document.getElementById('vastu-content');
            const messageBox = document.getElementById('message-box');
            const canvas = document.getElementById('compassCanvas');
            const compassFaceWrapper = document.getElementById('compass-face-wrapper');
            const ctx = canvas.getContext('2d');
            const compassContainer = document.querySelector('.compass-container');

            let compassRadius;

            // Updated Vastu data for the standard 32 zones
            const vastuData = {
                "N1": { "tips": "New opportunities and career growth.", "deity": "Kubera" },
                "N2": { "tips": "New opportunities and career growth.", "deity": "Kubera" },
                "N3": { "tips": "Increased profits and business growth.", "deity": "Aditi" },
                "N4": { "tips": "Increased profits and business growth.", "deity": "Diti" },
                "N5": { "tips": "Financial liquidity and cash.", "deity": "Agni" },
                "N6": { "tips": "Strength and confidence.", "deity": "Indra" },
                "N7": { "tips": "Mental churning and anxiety.", "deity": "Vivaswan" },
                "N8": { "tips": "Mental churning and anxiety.", "deity": "Vivaswan" },
                "NNE1": { "tips": "Health and immunity zone. Keep this area clutter-free.", "deity": "Ashwini Kumaras" },
                "NNE2": { "tips": "Health and immunity zone. Keep this area clutter-free.", "deity": "Ashwini Kumaras" },
                "NE1": { "tips": "Meditation and spiritual growth.", "deity": "Lord Shiva" },
                "NE2": { "tips": "Clarity and new thoughts.", "deity": "Lord Shiva" },
                "ENE1": { "tips": "Joy and social activity.", "deity": "Indra" },
                "ENE2": { "tips": "Joy and social activity.", "deity": "Indra" },
                "E1": { "tips": "Social associations.", "deity": "Sun" },
                "E2": { "tips": "Social associations.", "deity": "Sun" },
                "ESE1": { "tips": "Mental churning and anxiety.", "deity": "Vivaswan" },
                "ESE2": { "tips": "Mental churning and anxiety.", "deity": "Vivaswan" },
                "SE1": { "tips": "Financial liquidity and cash.", "deity": "Agni" },
                "SE2": { "tips": "Financial liquidity and cash.", "deity": "Agni" },
                "SSE1": { "tips": "Strength and confidence.", "deity": "Indra" },
                "SSE2": { "tips": "Strength and confidence.", "deity": "Indra" },
                "S1": { "tips": "Fame and recognition. Ideal for a bedroom.", "deity": "Yama" },
                "S2": { "tips": "Rest and relaxation.", "deity": "Yama" },
                "SSW1": { "tips": "Expenditure and disposal. Best for a storeroom or toilet.", "deity": "Nirrti" },
                "SSW2": { "tips": "Waste and disposal.", "deity": "Nirrti" },
                "SW1": { "tips": "Relationships and bonding.", "deity": "Pitra" },
                "SW2": { "tips": "Relationships and bonding.", "deity": "Pitra" },
                "WSW1": { "tips": "Academic growth and savings.", "deity": "Varuna" },
                "WSW2": { "tips": "Academic growth and savings.", "deity": "Varuna" },
                "W1": { "tips": "Gains and profits. An excellent zone for business operations.", "deity": "Vishwakarma" },
                "W2": { "tips": "Gains and profits.", "deity": "Vishwakarma" },
                "WNW1": { "tips": "Detoxification and release of emotions.", "deity": "Vayu" },
                "WNW2": { "tips": "Detoxification and release of emotions.", "deity": "Vayu" },
                "NW1": { "tips": "Financial support and banking.", "deity": "Rudra" },
                "NW2": { "tips": "Financial support and banking.", "deity": "Rudra" },
                "NNW1": { "tips": "Attraction and romance.", "deity": "Chandra" },
                "NNW2": { "tips": "Attraction and romance.", "deity": "Chandra" },
            };
            
            // Corrected vastuZones array, ordered with N5 at 0 degrees and N1 at the requested range.
            const vastuZones = [
                "N5", "N6", "N7", "N8",
                "NNE1", "NNE2",
                "NE1", "NE2",
                "ENE1", "ENE2",
                "E1", "E2",
                "ESE1", "ESE2",
                "SE1", "SE2",
                "SSE1", "SSE2",
                "S1", "S2",
                "SSW1", "SSW2",
                "SW1", "SW2",
                "WSW1", "WSW2",
                "W1", "W2",
                "WNW1", "WNW2",
                "NW1", "NW2",
                "NNW1", "NNW2",
                "N1", "N2", "N3", "N4"
            ];

            const mainVastuLabels = {
                "N": "N", "N1": "N", "N2": "N", "N3": "N", "N4": "N", "N5": "N", "N6": "N", "N7": "N", "N8": "N",
                "NNE": "NNE", "NNE1": "NNE", "NNE2": "NNE",
                "NE": "NE", "NE1": "NE", "NE2": "NE",
                "ENE": "ENE", "ENE1": "ENE", "ENE2": "ENE",
                "E": "E", "E1": "E", "E2": "E",
                "ESE": "ESE", "ESE1": "ESE", "ESE2": "ESE",
                "SE": "SE", "SE1": "SE", "SE2": "SE",
                "SSE": "SSE", "SSE1": "SSE", "SSE2": "SSE",
                "S": "S", "S1": "S", "S2": "S",
                "SSW": "SSW", "SSW1": "SSW", "SSW2": "SSW",
                "SW": "SW", "SW1": "SW", "SW2": "SW",
                "WSW": "WSW", "WSW1": "WSW", "WSW2": "WSW",
                "W": "W", "W1": "W", "W2": "W",
                "WNW": "WNW", "WNW1": "WNW", "WNW2": "WNW",
                "NW": "NW", "NW1": "NW", "NW2": "NW",
                "NNW": "NNW", "NNW1": "NNW", "NNW2": "NNW"
            };

            function resizeCanvas() {
                const size = Math.min(compassContainer.offsetWidth, compassContainer.offsetHeight);
                canvas.width = size;
                canvas.height = size;
                compassRadius = size / 2;
                drawCompassFace();
            }

            function drawCompassFace() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate(compassRadius, compassRadius);

                // --- Draw the 32 sector division lines ---
                ctx.save();
                ctx.strokeStyle = '#60a5fa'; /* Brighter lines for main vastu zones */
                ctx.lineWidth = 1;
                for (let i = 0; i < 360; i += 11.25) {
                    ctx.save();
                    ctx.rotate(i * Math.PI / 180);
                    ctx.beginPath();
                    ctx.moveTo(0, 0); // Start from the center
                    ctx.lineTo(0, -compassRadius); // Draw line to the edge
                    ctx.stroke();
                    ctx.restore();
                }
                ctx.restore();
                
                // Draw 1-degree markings
                ctx.strokeStyle = '#cbd5e1'; 
                ctx.lineWidth = 0.5;
                const innerMarkRadiusOne = compassRadius - 5;
                const outerMarkRadiusOne = compassRadius - 10;
                for (let i = 0; i < 360; i += 1) {
                    ctx.save();
                    ctx.rotate(i * Math.PI / 180);
                    ctx.beginPath();
                    ctx.moveTo(0, -innerMarkRadiusOne);
                    ctx.lineTo(0, -outerMarkRadiusOne);
                    ctx.stroke();
                    ctx.restore();
                }

                // Draw sub-degree markings (5-degree intervals)
                ctx.strokeStyle = '#94a3b8'; 
                ctx.lineWidth = 1.5;
                const innerMarkRadius = compassRadius - 20;
                const outerMarkRadius = compassRadius - 10;
                for (let i = 0; i < 360; i += 5) {
                    ctx.save();
                    ctx.rotate(i * Math.PI / 180);
                    ctx.beginPath();
                    ctx.moveTo(0, -innerMarkRadius);
                    ctx.lineTo(0, -outerMarkRadius);
                    ctx.stroke();
                    ctx.restore();
                }

                // Draw degree numbers and longer marks for 10-degree intervals
                ctx.font = '0.9rem Inter';
                ctx.fillStyle = '#e2e8f0';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const degreeTextRadius = compassRadius - 30; 
                ctx.lineWidth = 3; 
                for (let i = 0; i < 360; i += 10) {
                    ctx.save();
                    ctx.rotate(i * Math.PI / 180);
                    
                    ctx.beginPath();
                    ctx.moveTo(0, -compassRadius + 10);
                    ctx.lineTo(0, -compassRadius + 25);
                    ctx.stroke();

                    ctx.fillText(i, 0, -degreeTextRadius);
                    ctx.restore();
                }

                // Draw 16 primary direction labels
                const mainDirections = ["N", "NNE", "NE", "ENE", "E", "ESE", "SE", "SSE", "S", "SSW", "SW", "WSW", "W", "WNW", "NW", "NNW"];
                const mainSectorAngle = 360 / mainDirections.length;
                
                const vastuLabelRadius = compassRadius - 90;
                mainDirections.forEach((sector, index) => {
                    ctx.save();
                    const textAngle = (index * mainSectorAngle + mainSectorAngle/2) * Math.PI / 180;
                    ctx.rotate(textAngle - Math.PI / 2);
                    
                    ctx.font = `1.2rem Inter`;
                    ctx.fillStyle = '#60a5fa';
                    
                    ctx.fillText(sector, 0, -vastuLabelRadius);
                    ctx.restore();
                });
                
                ctx.beginPath();
                ctx.arc(0, 0, 10, 0, Math.PI * 2);
                ctx.fillStyle = '#1f2937';
                ctx.fill();
                ctx.restore();
            }

            function getDirectionFromAngle(angle) {
                // Each of the 32 zones is 11.25 degrees wide (360 / 32)
                const sectorAngle = 11.25; 
                // The compass starts at N, and we need to offset the angle to map to the correct array index
                let normalizedAngle = (angle + 360 + 5.625) % 360; // 5.625 is half a sector to center the zones
                const index = Math.floor(normalizedAngle / sectorAngle);
                return vastuZones[index];
            }

            function updateVastuTips(direction) {
                const data = vastuData[direction];
                if (data) {
                    vastuTips.innerHTML = `
                        <h3 class="font-semibold text-lg text-blue-300">Vastu Tips for <span class="text-red-400 font-bold">${direction}</span></h3>
                        <p class="text-gray-300"><strong>Tips:</strong> ${data.tips}</p>
                        <p class="text-gray-300"><strong>Deity:</strong> ${data.deity}</p>
                    `;
                } else {
                    vastuTips.innerHTML = `<p>No specific tips available for this zone. Hold your device steady.</p>`;
                }
            }

            function handleOrientation(event) {
                let alpha = event.alpha;
                if (event.webkitCompassHeading !== undefined) {
                    alpha = event.webkitCompassHeading;
                }
                const direction = getDirectionFromAngle(alpha);
                
                // Rotate the compass face itself, not the needle
                compassFaceWrapper.style.transform = `rotate(${-alpha}deg)`;
                
                angleDisplay.textContent = `${Math.round(alpha)}Â°`;
                directionName.textContent = direction;
                updateVastuTips(direction);
            }

            function requestPermission() {
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(response => {
                            if (response === 'granted') {
                                window.addEventListener('deviceorientation', handleOrientation);
                                messageBox.innerHTML = '<p>Device access granted. Rotate your device to use the compass.</p>';
                                permissionButton.style.display = 'none';
                                updateVastuTips("N5");
                            } else {
                                messageBox.innerHTML = '<p>Permission denied. The compass will not work.</p>';
                            }
                        })
                        .catch(console.error);
                } else {
                    window.addEventListener('deviceorientation', handleOrientation);
                    messageBox.innerHTML = '<p>Ready! Rotate your device to use the compass.</p>';
                    permissionButton.style.display = 'none';
                    updateVastuTips("N5");
                }
            }

            if (window.DeviceOrientationEvent) {
                permissionButton.style.display = 'block';
                permissionButton.addEventListener('click', requestPermission);
            } else {
                messageBox.innerHTML = '<p>Your device does not support the required sensors for this compass.</p>';
                permissionButton.style.display = 'none';
            }

            window.addEventListener('resize', resizeCanvas);
            resizeCanvas();
        });
    </script>
</body>
</html>
